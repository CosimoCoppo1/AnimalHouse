<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<base href="http://site212225.tw.cs.unibo.it/">
		<title>Servizi in negozio</title>
		<link rel="stylesheet" href="bootstrap-5.2.0-dist/css/bootstrap.min.css">
		
		<script type="application/javascript" src="/bootstrap-5.2.0-dist/js/bootstrap.min.js"></script>
		<script src="jquery-3.6.0.js"></script>
		<script>

		function getPets()
		{
			$.get('http://site212225.tw.cs.unibo.it/pets')
			.then((res) => {
				showPetsRadio(res);
			})
			.catch((err) => {
				console.error(err);
			});
		}

		function showPetsRadio(pets)
		{
			const r = $('#pets-radio');
			let innerHTML = '';

			for (let i = 0; i < pets.length; i++) {
				innerHTML += `
				<div class="form-check form-check-inline">
					<input type="radio" class="form-check-input" name="pet" 
					id="${pets[i].name}" value="${pets[i]._id}" autocomplete="off" required>
					<label class="form-check-label" for="${pets[i].name}">${pets[i].name}</label>
				</div>`;
			}
			r.html(innerHTML);

			setPetsRadioListener()
		}

		function setPetsRadioListener()
		{
			$('input[type="radio"][name="pet"]').click(() => {
				const pet = $('input[type="radio"][name="pet"]:checked').attr('value');
				getServices(pet);
			});

		}

		function getServices(pet)
		{
			$.get(`http://site212225.tw.cs.unibo.it/services?pet=${pet}`)
			.then((res) => {
				showServicesSelect(res);
			})
			.catch((err) => {
				console.error(err);
			})
		}

		function showServicesSelect(services)
		{
			const sel = $('#service-select');
			let innerHTML = '<option value="All">Tutti i servizi </option>';

			for (let i = 0; i < services.length; i++) {
				innerHTML += `<option value="${services[i]._id}">${services[i].name}</option>`;
			}

			sel.html(innerHTML);
		}

		function getLocations()
		{
			$.get('http://site212225.tw.cs.unibo.it/locations')
			.then((res) => {
				showLocationsSelect(res);
			})
			.catch((err) => {
				console.error(err);
			});
		}

		function getBookable_service()
		{
			const form = $('#serch-form');
			const action = form.attr('action');

			const p = $('input[type="radio"][name="pet"]:checked').attr('value');
			const l = $('#location-select option:selected').attr('value');
			const s = $('#service-select option:selected').attr('value');

			let uri = `http://site212225.tw.cs.unibo.it/bookable_services?pet=${p}`;
			if (l !== 'All') uri += `&location=${l}`;
			if (s !== 'All') uri += `&service=${s}`;
			console.log(uri);
			$.get(uri)
			.then((res) => {
				showSearchResult(res);
			})
			.catch((err) => {
				console.error(err);
			});

		}

		function showSearchResult(results)
		{
			for (let i = 0; i < results.length; i++) {
				console.log(results[i]);
			}
		}

		function showLocationsSelect(locations)
		{
			const sel = $('#location-select');
			let innerHTML = '<option value="All">Tutte le sedi</option>';

			for (let i = 0; i < locations.length; i++) {
				innerHTML += `<option value="${locations[i]._id}">${locations[i].city} - ${locations[i].address}</option>`;
			}
			sel.html(innerHTML);
		}
			
		$(document).ready(() => {
			getPets();
			getLocations();

			$('#search-form').submit((event) => {
				getBookable_service();
				return false;
			});
		});

		</script>
	</head>

	<body>
		<header>
			<div class="container-fluid">
				<div class="row d-flex flex-nowrap my-3 px-0 px-sm-5">
					<div class="col-2 col-lg-1">
						<span><img class="img-fluid" src="backoffice/img/company.png" alt="Company logo"></span>
					</div>
					<div class="col-auto d-flex align-items-center">
						<h1>BACK OFFICE APPS</h1>
					</div>
				</div>
			</div>

			<!-- NAVBAR GLOBAL -->
			<div class="row border-top border-bottom border-secondary bg-secondary mt-3 px-0 px-sm-5" style="--bs-bg-opacity: .15;">
				<nav class="navbar navbar-expand-lg" style="padding-top: 4px;padding-bottom: 4px;">
					<div class="container-fluid">
						<a class="navbar-brand" href="backoffice/">Backoffice</a>
						<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
						  <span class="navbar-toggler-icon"></span>
						</button>
						<div class="collapse navbar-collapse" id="navbarNav">
							<ul class="navbar-nav">
								<li class="nav-item">
									<a class="nav-link" href="#">Gestione utenti</a>
								</li>
								<li class="nav-item">
									<a class="nav-link" href="backoffice/ecommerce.html">Ecommerce</a>
								</li>
								<li class="nav-item">
									<a class="nav-link active" aria-current="page" href="backoffice/services.html">Serivizi in negozio</a>
								</li>
								<li class="nav-item">
									<a class="nav-link" href="#">Servizi di comunità</a>
								</li>
							</ul>
						</div>
					</div>
				</nav>
			</div>
			<!-- END navbar global -->

		</header>

		<main class="my-5">
			<div class="container">

				<!-- SEARCH form -->
				<form id="search-form" class="border border-success p-3" style="border-radius: 25px;">
					<div class="mb-3">
						<fieldset>
							<legend class="form-label">Seleziona per quale animale è il servizio: </legend>
							<div id="pets-radio">
							</div>
						</fieldset>
					</div>
					<div class="mb-3">
						<label for="location-select" class="form-label">Seleziona la sede</label>
						<select class="form-select" id="location-select" aria-label="Seleziona la sede">
							<option value="All">Tutte le sedi</option>
						</select>	
					</div>
					<div class="mb-3">
						<label for="service-select" class="form-label">Seleziona il servizio</label>
						<select class="form-select" id="service-select" aria-label="Seleziona il singolo servizio per il tuo animale">
							<option value="All">Tutti i servizi </option>
						</select>
					</div>
					<button type="submit" class="btn btn-success">Cerca</button>
				</form>
				<!-- END search form -->

				<div id="search-result">
				</div>
				
			</div>
		</main>
		<footer class="border-top bg-secondary" style="--bs-bg-opacity: .1">
			<div class="container-fluid py-5">
				<p class="text-center">Questa è una frase finale per riempire lo spazio del footer</p>
			</div>
		</footer>
	</body>
</html>
